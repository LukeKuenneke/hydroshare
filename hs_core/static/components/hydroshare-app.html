<link href="http://polygit.org/components/polymer/polymer.html" rel="import" />
<link href="http://polygit.org/components/iron-pages/iron-pages.html" rel="import" />
<link href="http://polygit.org/components/app-route/app-location.html" rel="import" />
<link href="http://polygit.org/components/app-route/app-route.html" rel="import" />

<link href="./hydroshare-api.html" rel="import">

<dom-module id="hydroshare-app">
  <template>
    <app-location route="{{ route }}"></app-location>
    <app-route route="{{ route }}" pattern="/:page" data="{{ routeData }}"></app-route>

    <iron-pages attr-for-selected="name" selected="{{ routeData.page }}">
      <hydroshare-my-resources name="my-resources"></hydroshare-my-resources>
    </iron-pages>
  </template>

  <script>
    Polymer({
      is: "hydroshare-app",

      properties: {
        spa_pages: {
          type: Array,
          value: ["my-resources"]
        },
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged',
        },
        initialRoute: String
      },

      observers: [
        '_routePageChanged(routeData.page)',
      ],

      _routePageChanged: function(page) {
        if(this.initialRoute === "NONE") this.set('initialRoute', page);

        if((this.initialRoute !== page) && (this.spa_pages.indexOf(page) === -1 || page === "")) {
          window.location = '/' + page;
        } else if(page !== "" && this.spa_pages.indexOf(page) > -1) {
          this.importHref("/static/components/hydroshare-" + page + ".html", null, this._showPage404, true);

          if(document.querySelector("#nonspa")) {
            document.querySelector("#nonspa").remove();
          }
        }

      },

      _showPage404: function() {
        console.log("showPage404");
      },

      created: function() {
        this.initialRoute = "NONE";
      }
    })
  </script>
</dom-module>
